<table class="table advice-table">
  <thead>
    <tr>
      <th><%= t('schools.user_tariffs.meters.meter') %></th>
      <th><%= t('schools.user_tariffs.tariff_partial.start_date') %></th>
      <th><%= t('schools.user_tariffs.tariff_partial.end_date') %></th>
      <th><%= t('schools.user_tariffs.tariff_partial.type') %></th>
      <th><%= t('schools.user_tariffs.tariff_partial.consumption_charges') %></th>
      <th><%= t('schools.user_tariffs.show.standing_charges') %></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% meters.each do |meter| %>
      <% smart_meter_tariffs(meter).each do |tariff_attributes| %>
        <tr>
          <td><%= meter.name_or_mpan_mprn %></td>
          <td><%= tariff_attributes[:start_date].to_s(:es_compact) %></td>
          <td><%= tariff_attributes[:end_date].to_s(:es_compact) %></td>
          <td>
            <% if tariff_attributes[:type] == :flat_rate %>
              <%= t('schools.user_tariffs.tariff_partial.simple_tariff') %>
            <% elsif tariff_attributes[:type] == :differential %>
              <%= t('schools.user_tariffs.tariff_partial.day_night_tariff') %>
            <% else %>
              <%= t('schools.user_tariffs.smart_meter_tariffs.tariff_types.differential_tiered') %>
            <% end %>
          </td>
          <td>
            <% if tariff_attributes[:type] == :flat_rate %>
              <%= t('schools.user_tariffs.rates_table.price_per_kwh',
                price_value: FormatEnergyUnit.format(:£, tariff_attributes[:rates][:flat_rate][:rate], :text, false, false, :accountant)) %>
            <% elsif tariff_attributes[:type] == :differential  %>
              <% rates = tariff_attributes[:rates].reject { |k| k == :standing_charge } %>
              <ul style="list-style: none; padding-left: 0px;">
                <% rates.each do |_r, price| %>
                  <li>
                    <%= t('schools.user_tariffs.tariff_partial.price_from_to', price_start_time: price[:from], price_end_time: price[:to]) %> <%= t('schools.user_tariffs.rates_table.price_per_kwh',
                      price_value: FormatEnergyUnit.format(:£, price[:rate], :text, false, false, :accountant)) %>
                  </li>
                <% end %>
              </ul>
            <% end %>
          </td>
          <td>
              <%= t('schools.user_tariffs.smart_meter_tariffs.tariff_charges.per_day', charge: FormatEnergyUnit.format(:£, tariff_attributes[:rates][:standing_charge][:rate], :text, false, false, :accountant)) %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
