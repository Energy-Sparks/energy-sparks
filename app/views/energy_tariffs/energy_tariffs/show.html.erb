<h1><%= @energy_tariff.name %></h1>

<div class="energy_tariff">

  <% if @energy_tariff.tariff_holder.school? %>
    <p>
      <%= t('schools.user_tariffs.show.introduction_html', analysis_path: analysis_page_finder_path(urn: @tariff_holder.urn, analysis_class: cost_analysis_class_for(@energy_tariff.meter_type)), meter_type: t("common.#{@energy_tariff.meter_type}").downcase) %>.
    </p>
    <br/>
  <% end %>

  <div class="d-flex justify-content-between">
    <div>
      <h4><%= t('schools.user_tariffs.show.dates.title') %></h4>
    </div>
    <div>
      <%= link_to t('common.labels.edit'),
          energy_tariffs_path(@energy_tariff, [], { action: :edit }),
          class: 'btn'
      %>
    </div>
  </div>

  <table class="table table-charges">
    <tbody>
      <tr>
        <td class="description"><%= t('schools.user_tariffs.show.dates.start_date') %></td>
        <td class="value"><%= @energy_tariff&.start_date&.to_s(:es_compact) %></td>
      </tr>
      <tr>
        <td class="description"><%= t('schools.user_tariffs.show.dates.end_date') %></td>
        <td class="value"><%= @energy_tariff&.end_date&.to_s(:es_compact) %></td>
      </tr>
    </tbody>
  </table>

  <br/>

  <div class="d-flex justify-content-between">
    <div>
      <h4>Meters</h4>
    </div>
    <div>
      <%= link_to t('common.labels.edit'),
          energy_tariffs_path(@energy_tariff, [], { action: :edit_meters }),
          class: 'btn'
      %>
    </div>
  </div>

  <table class="table table-charges">
    <tbody>
      <% if @energy_tariff.meters.empty? %>
        <tr>
          <td class="description"><%= t('schools.user_tariffs.meters.this_tariff_applies_to_all_meters', meter_type: t("common.#{@energy_tariff.meter_type}")) %></td>
          <td class="value"></td>
        </tr>
      <% end %>

      <% @energy_tariff.meters.each do |meter| %>
        <tr>
          <td class="description"><%= meter.mpan_mprn_and_name %></td>
          <td class="value"></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <br/>

  <div class="d-flex justify-content-between">
    <div>
      <h4><%= t('schools.user_tariffs.show.consumption_charges') %></h4>
    </div>
    <% if @energy_tariff.tariff_holder.school? %>
      <div>
        <%= link_to t('common.labels.edit'), school_energy_tariff_energy_tariff_prices_path(@tariff_holder, @energy_tariff), class: 'btn' %>
      </div>
    <% end %>
    <% if @energy_tariff.tariff_holder.site_settings? %>
      <div>
        <%= link_to t('common.labels.edit'), admin_settings_energy_tariff_energy_tariff_prices_path(@energy_tariff), class: 'btn' %>
      </div>
    <% end %>
  </div>


  <% if @energy_tariff.flat_rate? %>
    <%= render 'energy_tariffs/energy_tariffs/flat_rate', school: @tariff_holder, energy_tariff: @energy_tariff, allow_edits: false %>
  <% else %>
    <%= render 'energy_tariffs/energy_tariffs/rates_table', school: @tariff_holder, energy_tariff: @energy_tariff, allow_edits: false %>
  <% end %>

  <br/>

  <div class="d-flex justify-content-between">
    <div>
      <h4><%= t('schools.user_tariffs.show.standing_charges') %></h4>
    </div>
    <% if @energy_tariff.tariff_holder.school? %>
      <div>
        <%= link_to t('common.labels.edit'), school_energy_tariff_energy_tariff_charges_path(@tariff_holder, @energy_tariff), class: 'btn btn-primary' %>
      </div>
    <% end %>
    <% if @energy_tariff.tariff_holder.site_settings? %>
      <div>
        <%= link_to t('common.labels.edit'), admin_settings_energy_tariff_energy_tariff_charges_path(@energy_tariff), class: 'btn btn-primary' %>
      </div>
    <% end %>
  </div>

  <%= render 'energy_tariffs/energy_tariffs/charges_table', school: @tariff_holder, energy_tariff: @energy_tariff, allow_edits: false %>

  <br/>
  <br/>

  <%= link_to t('common.labels.previous'), energy_tariffs_path(@energy_tariff, [:energy_tariff_charges]), class: 'btn' %>
  <%= link_to t('common.labels.finished'), energy_tariffs_path(@energy_tariff, [], { energy_tariff_index: true }), class: 'btn' %>

  <div class="hidden">
    <% if can? :download, EnergyTariff %>
      <h4><%= t('schools.user_tariffs.show.meter_attribute_view') %></h4>
      <%= print_meter_attribute(@energy_tariff.meter_attribute) %>
    <% end %>
  </div>
</div>
