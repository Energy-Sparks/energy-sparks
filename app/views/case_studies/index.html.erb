<% content_for :page_title, t('case_studies.title') %>

<% if Flipper.enabled?(:new_case_studies_page, current_user) %>
  <div class="container-fluid adult mb-5 py-4">
    <%= render Layout::GridComponent.new(cols: 2, classes: 'container p-4', id: 'hero') do |grid| %>
      <% grid.with_iframe classes: 'rounded-xl', cell_classes: 'pr-xl-4', src: 'https://www.youtube.com/embed/PqoKZjwgmoY' %>
      <% grid.with_feature_card size: :xl, cell_classes: 'my-auto pl-xl-4' do |feature| %>
        <%= feature.with_header title: t('case_studies.feature.title'), classes: 'mt-3 mt-lg-0' %>
        <%= feature.with_description { t('case_studies.feature.description_html', count: School.active.visible.count) } %>
        <%= feature.with_button t('nav.enrol'), find_out_more_campaigns_path, style: :primary %>
        <%= feature.with_button t('home.buttons.book_a_demo'),
                                book_demo_campaigns_path,
                                style: :secondary %>
      <% end %>
    <% end %>
  </div>

 <div class="container mt-4">
  <%= render Layout::GridComponent.new(
        id: 'case-studies',
        cols: 3,
        classes: 'container pb-4',
        cell_classes: 'mb-4',
        component_classes: 'h-100'
      ) do |grid| %>

      <% @case_studies.each do |case_study| %>
        <%= grid.with_card do |card| %>
          <%= card.with_image(src: case_study.image, rounded: :top) if case_study.image.attached? && @show_images %>
          <%= card.with_feature_card(
                theme: :light, size: :sm,
                classes: "p-4 rounded-bottom-xl #{'rounded-top-xl' if !case_study.image.attached? || !@show_images}"
              ) do |feature| %>
            <% case_study.tag_list.each do |tag| %>
              <%= feature.with_tag(tag) %>
            <% end %>
            <%= feature.with_header(title: case_study.title) %>
            <%= feature.with_description { case_study.description.to_s } %>
            <%= feature.with_link(
                  href: case_study_download_path(
                    case_study,
                    locale: case_study.file_locale
                  ),
                  download: true
                ) { t('common.labels.download') } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
<% else %>
  <%= render 'home/case_studies', case_studies: @case_studies, all_case_studies_count: 0 %>
<% end %>
