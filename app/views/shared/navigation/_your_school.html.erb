<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" data-toggle="dropdown" id="your_school" href="#"
     role="button" aria-haspopup="true" aria-expanded="false"><%= 'Your school' %></a>
  <div class="dropdown-menu scrollable" aria-labelledby="your_school" id="your_school_menu">
    <%= link_to 'Dashboard', school_path(current_user_school), class: 'dropdown-item' %>

    <!-- Your school group - please validate how this is determined in current_user_school_group -->
    <% if current_user_school_group %>
      <%= link_to 'Your school group', school_group_path(current_user_school_group), class: 'dropdown-item' %>
    <% end %>

    <!-- Electricity, solar, gas and storage heater usage -->
    <% if current_user.school.data_enabled? %>
      <% if current_user.school.has_solar_pv? %>
        <%= link_to t('my_school_menu.electricity_and_solar_usage'),
                    pupils_school_analysis_path(current_user.school, category: :solar), class: 'dropdown-item' %>
      <% elsif current_user.school.has_electricity? %>
        <%= link_to t('my_school_menu.electricity_usage'),
                    pupils_school_analysis_path(current_user.school, category: :electricity), class: 'dropdown-item' %>
      <% end %>
      <%= if current_user.school.has_gas?
            link_to t('my_school_menu.gas_usage'),
                    pupils_school_analysis_path(current_user.school, category: :gas),
                    class: 'dropdown-item'
          end %>
      <%= if current_user.school.has_storage_heaters?
            link_to t('my_school_menu.storage_heater_usage'),
                    pupils_school_analysis_path(current_user.school, category: :storage_heaters),
                    class: 'dropdown-item'
          end %>
      <% if EnergySparks::FeatureFlags.active?(:live_data) %>
        <%= if current_user.school.has_live_data?
              link_to t('my_school_menu.live_energy_data'),
                      school_live_data_path(current_user.school),
                      class: 'dropdown-item'
            end %>
      <% end %>
    <% end %>

    <!-- Energy analysis -->
    <% if current_user.school.data_enabled? %>
      <%= link_to t('my_school_menu.energy_audits'),
                  school_audits_path(current_user.school), class: 'dropdown-item' %>
      <%= link_to t('my_school_menu.energy_analysis'),
                  school_advice_path(current_user.school), class: 'dropdown-item' %>
    <% end %>

    <!-- Review targets -->
    <% if current_user.school.data_enabled? &&
          Targets::SchoolTargetService.targets_enabled?(current_user.school) &&
          can?(:manage, SchoolTarget) &&
          Targets::SchoolTargetService.new(current_user.school).enough_data? %>
      <%= link_to t('my_school_menu.review_targets'),
                  school_school_targets_path(current_user.school),
                  class: 'dropdown-item' %>
    <% end %>

    <!-- Anything with a '*' is not mentioned in the design. Wondering where they would go otherwise so left them in for discussion -->

    <% if current_user.school&.school_group&.present? %>
      <!-- Compare schools -->
      <%= link_to "#{t('schools.school_group.compare_schools')} *",
                  "#{compare_index_path(school_group_ids: [current_user.school.school_group.id])}#groups",
                  class: 'dropdown-item' %>
    <% end %>

    <!-- Complete pupil activities -->
    <!-- removed as in the top menu -->
    <%#= link_to t('my_school_menu.complete_pupil_activities'), activity_categories_path, class: 'dropdown-item' %>

    <!-- Energy saving actions -->
    <!-- removed as in the top menu -->
    <%#= link_to t('my_school_menu.energy_saving_actions'), intervention_type_groups_path, class: 'dropdown-item' %>

    <!-- School programmes -->
    <%= link_to t('my_school_menu.school_programmes'), programme_types_path, class: 'dropdown-item' %>

    <!-- Scoreboard -->
    <% if current_user.default_scoreboard %>
      <%= link_to "#{t('my_school_menu.scoreboard')} *",
                  scoreboard_path(current_user.default_scoreboard),
                  class: 'dropdown-item' %>
    <% end %>

    <!-- My alerts -->
    <% if current_user.contact_for_school %>
      <%= link_to "#{t('my_school_menu.my_alerts')} *",
                  edit_school_contact_path(current_user.school, current_user.contact_for_school), class: 'dropdown-item' %>
    <% elsif can? :create, Contact %>
      <%= link_to "#{t('my_school_menu.my_alerts')} *",
                  new_school_contact_path(current_user.school, user_id: current_user.id), class: 'dropdown-item' %>
    <% end %>

    <div class="dropdown-divider"></div>

    <!-- to be implemented! -->
    <%= link_to(school_path(current_user.school), class: 'dropdown-item') do %>
      Your school settings <%= fa_icon 'cog' %>
    <% end %>
    <!-- Download your data -->
    <% if current_user.school.data_enabled? %>
      <%= link_to(school_downloads_path(current_user.school),
                  id: 'download-your-data', class: 'dropdown-item') do %>
        Download your data <%= fa_icon 'download' %>
      <% end %>
    <% end %>
  </div>
</li>
