<%= content_for :page_title, t('pupils.schools.show.title', school_name: @school.name) %>

<% if show_admin_page_switch?(@school) %>
  <div class="row mt-2 mb-2">
    <div class="col">
      <div class="float-right">
        <% if params[:no_data] %>
          <%= link_to t('pupils.schools.show.admin_view'), pupils_school_path(@school), class: 'btn btn-outline-dark bg-warning rounded-pill font-weight-bold' %>
        <% else %>
          <%= link_to t('pupils.schools.show.user_view'), pupils_school_path(@school, no_data: true), class: 'btn btn-outline-dark bg-warning rounded-pill font-weight-bold' %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<% if @show_data_enabled_features %>
  <%= render 'equivalences', equivalences_content: @equivalences_content, school: @school if @equivalences_content.present? %>

  <h2 class="mt-2"><%= t('pupils.schools.show.look_at_the_energy_use') %>:</h2>
  <%= render 'pupils/analysis/top_level', school: @school %>
<% else %>
  <%= render 'default_equivalences', equivalences: @default_equivalences, chool: @school %>
  <%= render 'schools/dashboard/info_bar',
        colour: 'bg-neutral',
        icon: 'info-circle fa-3x',
        content: t('pupils.schools.show.setting_up'),
        buttons: {}
  %>
<% end %>

<h2 class="mt-2"><%= t('pupils.schools.show.things_to_do') %></h2>
<% if @dashboard_alerts && @dashboard_alerts.any? %>
  <% @dashboard_alerts.each do |content| %>
    <%= render 'schools/dashboard/info_bar',
          colour: class_for_alert_colour(content.colour),
          icon: alert_icon(content.alert, 'fa-3x'),
          content: content.pupil_dashboard_title,
          buttons: content.find_out_more ? { t('pupils.schools.show.find_out_more') => school_find_out_more_path(@school, content.find_out_more) } : {}
    %>
   <% end %>
<% end %>

<% if @show_temperature_observations %>
  <% if @temperature_observations.empty? %>
    <%= render 'schools/dashboard/info_bar',
          colour: 'bg-neutral',
          icon: 'temperature-high fa-3x',
          content: t('pupils.schools.show.measure_temperatures'),
          buttons: { t('pupils.schools.show.enter_temperatures') => new_school_temperature_observation_path(@school, introduction: true) }
    %>
  <% else %>
    <%= render 'schools/dashboard/info_bar',
          colour: 'bg-neutral',
          icon: 'temperature-high fa-3x',
          content: t('pupils.schools.show.updating_temperatures'),
          buttons: { t('pupils.schools.show.previous_temperatures') => school_temperature_observations_path(@school), t('pupils.schools.show.update_temperatures') => new_school_temperature_observation_path(@school, introduction: true) }
    %>
  <% end %>
<% end %>

<% if @school.transport_surveys.empty? %>
  <%= render 'schools/dashboard/info_bar',
        colour: 'bg-neutral',
        icon: 'car-alt fa-3x',
        content: t('pupils.schools.show.transport_surveys'),
        buttons: { t('pupils.schools.show.start_transport_survey') => school_transport_surveys_path(@school) }
  %>
<% else %>
  <%= render 'schools/dashboard/info_bar',
        colour: 'bg-neutral',
        icon: 'car-alt fa-3x',
        content: t('pupils.schools.show.transport_surveys'),
        buttons: { t('pupils.schools.show.view_transport_surveys') =>
          school_transport_surveys_path(@school), t('pupils.schools.show.start_transport_survey') => start_school_transport_surveys_path(@school) }
  %>
<% end %>

<div class="row">
  <div class="col card-deck actions">
    <div class="card">
      <div class="card-body">
        <h4 class="text-center">
          <strong>
            <% if @first %>
              <%= t('pupils.schools.show.no_activities_completed') %>
            <% else %>
              <%= t('pupils.schools.show.activities_completed', count: @activities_count) %>
            <% end %>
          </strong>
        </h4>
        <% if @suggestion %>
          <h5 class="text-center">
            <%= @first ? t('pupils.schools.show.try_this_first') : t('pupils.schools.show.try_this_next') %>:
          </h5>
          <div class="activity-suggestion">
            <p><%= link_to @suggestion.name, activity_type_path(@suggestion) %></p>
            <span class="btn bg-neutral rounded-pill">
              <strong class="text-uppercase">
                <%= @suggestion.score %><span class="small"> <%= t('pupils.schools.show.points') %></span>
              </strong>
              /
              <span class="key-stages"><%= @suggestion.key_stage_list %></span>
            </span>
          </div>
        <% end %>
      </div>
      <div class="card-footer text-center">
        <%= link_to t('pupils.schools.show.choose_another_activity'), activity_categories_path, class: 'btn btn-lg btn-light rounded-pill font-weight-bold' %>
      </div>
    </div>
  </div>



  <div class="col card-deck actions">
    <% if current_school_podium && can?(:read, current_school_podium.scoreboard) %>
      <div class="card surrounding-schools">
        <div class="card-body">
          <% if current_school_podium.includes_school? %>
            <%= render 'pupils/schools/podium', podium: current_school_podium  %>
          <% else %>
            <%= render 'pupils/schools/no_points_podium', podium: current_school_podium  %>
          <% end %>
        </div>
        <div class="card-footer text-center">
          <%= link_to t('pupils.schools.show.see_scoreboard'), scoreboard_path(current_school_podium.scoreboard), class: "btn btn-lg btn-light rounded-pill font-weight-bold" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<br/>
<br/>

<%= render 'shared/dashboard_timeline', school: @school, observations: @observations %>

<% unless user_signed_in? %>
  <%= render 'shared/school_login_prompt', school: @school %>
<% end %>
