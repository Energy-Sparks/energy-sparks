<div class='text-right mt-2'>
  <%= download_link(report, table_name, index_params) %>
</div>

<table id="<%= comparison_table_id(report, table_name) %>" class="table advice-table table-sorted">
  <thead class="sticky-heading">
    <tr>
      <th><%= t('analytics.benchmarking.configuration.column_headings.school') %></th>
      <th class="text-right">
        <%= t('analytics.benchmarking.configuration.column_headings.change_pct') %>
      </th>
      <th class="text-right">
        <%= t('analytics.benchmarking.configuration.column_headings.change_£current') %>
      </th>
      <th class="text-right">
        <%= t('analytics.benchmarking.configuration.column_headings.change_kwh') %>
      </th>
    </tr>
  </thead>
  <tbody>
    <% pupils_changed_footnote = false %>
    <% tariff_has_changed_footnote = false %>
    <% infinite_increase_footnote = false %>
    <% infinite_decrease_footnote = false %>
    <% results.each do |result| %>
      <tr>
        <td>
          <%= result.school.name %>
          <% if result.pupils_changed %>
            <% pupils_changed_footnote = true %>
            <a href="#footnotes">(*1)</a>
          <% end %>
          <% if result.difference_percent.infinite? == 1 %>
            <% infinite_increase_footnote = true %>
            <a href="#footnotes">(*2)</a>
          <% end %>
          <% if result.difference_percent.infinite? == -1 %>
            <% infinite_decrease_footnote = true %>
            <a href="#footnotes">(*3)</a>
          <% end %>
          <% if result.tariff_has_changed %>
            <% tariff_has_changed_footnote = true %>
            <a href="#footnotes">(*6)</a>
          <% end %>
        </td>
        <td class="text-right">
          <%= up_downify(format_unit(result.difference_percent, :relative_percent_0dp, true, :benchmark)) %>
        </td>
        <td class="text-right">
          <%= up_downify(format_unit(result.difference_gbpcurrent, :£_0dp, true, :benchmark)) %>
        </td>
        <td class="text-right">
          <%= up_downify(format_unit(result.difference_kwh, :kw, true, :benchmark)) %>
        </td>
      </tr>
    <% end %>
  </tbody>
  <% if pupils_changed_footnote || tariff_has_changed_footnote %>
    <tfoot>
      <tr>
        <td colspan="4">
          <a name="footnotes"><strong><%= t('analytics.benchmarking.content.footnotes.notes') %></strong></a>
          <ul>
            <% if pupils_changed_footnote %>
              <%= t('analytics.benchmarking.content.footnotes.electricity.change_rows_text',
                    period_type_string:
                      t('analytics.benchmarking.content.benchmark_holidays_change_base.period_types')).html_safe %>
            <% end %>
            <% if infinite_increase_footnote %>
              <%= t('analytics.benchmarking.content.footnotes.electricity.infinite_increase_school_names_text',
                    period_type_string:
                      t('analytics.benchmarking.content.benchmark_holidays_change_base.period_types')).html_safe %>
            <% end %>
            <% if infinite_decrease_footnote %>
              <%= t('analytics.benchmarking.content.footnotes.electricity.infinite_decrease_school_names_text',
                    period_type_string:
                      t('analytics.benchmarking.content.benchmark_holidays_change_base.period_types')).html_safe %>
            <% end %>
            <% if tariff_has_changed_footnote %>
              <%= t('analytics.benchmarking.content.footnotes.rate_changed_in_period',
                    change_gbp_current_header:
                      t('analytics.benchmarking.configuration.column_headings.change_£current')).html_safe %>
            <% end %>
          </ul>
        </td>
      </tr>
    </tfoot>
  <% end %>
</table>
