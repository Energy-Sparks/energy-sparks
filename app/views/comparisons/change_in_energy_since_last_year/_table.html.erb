<%= component 'comparison_table',
              report: report, advice_page: advice_page, table_name: table_name, index_params: index_params,
              headers: headers, colgroups: colgroups, advice_page_tab: advice_page_tab do |c| %>
  <% @results.each do |result| %>
    <% c.with_row do |r| %>
      <% r.with_school school: result.school %>
        <%= r.with_var do %>
          <% if !result.current_year_electricity_kwh.nil? %>
            <span class="<%= fuel_type_class(:electricity) %>">
              <%= fa_icon(fuel_type_icon(:electricity)) %>
            </span>
          <% end %>
          <% if !result.current_year_gas_kwh.nil? %>
            <span class="<%= fuel_type_class(:gas) %>">
              <%= fa_icon(fuel_type_icon(:gas)) %>
            </span>
          <% end %>
          <% if !result.current_year_storage_heaters_kwh.nil? %>
            <span class="<%= fuel_type_class(:storage_heater) %>">
              <%= fa_icon(fuel_type_icon(:storage_heater)) %>
            </span>
          <% end %>
        <% end %>

        <% %i[kwh co2 Â£].each do |unit| %>
          <%= r.with_var val: sum_if_complete(result.all_previous_year(unit: unit),
                                              result.all_current_year(unit: unit)),
                         unit: unit %>
          <%= r.with_var val: sum_data(result.all_current_year(unit: unit)), unit: unit %>
          <%= r.with_var val: percent_change(
                sum_if_complete(result.all_previous_year(unit: unit), result.all_current_year(unit: unit)),
                sum_data(result.all_current_year(unit: unit))
              ),
                         change: true,
                         unit: :relative_percent_0dp %>
        <% end %>

      <%= r.with_var do
            'Y' if result.school.has_electricity? && result.current_year_electricity_kwh.nil? ||
                   result.school.has_gas? && result.current_year_gas_kwh.nil?
          end %>
    <% end %>
  <% end %>
<% end %>
