<% content_for :page_title, 'Baseload Per Pupil' %>

<h1><%= t('analytics.benchmarking.chart_table_config.baseload_per_pupil') %></h1>

<%= render 'compare/summary' %>

<%= t('analytics.benchmarking.content.baseload_per_pupil.introduction_text_html') %>

<%= t('analytics.benchmarking.caveat_text.es_exclude_storage_heaters_and_solar_pv').html_safe %>

<ul class="nav nav-tabs locales url-aware" id="compare-results-tabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="tables-tab" data-toggle="tab" href="#tables"
        role="tab" aria-controls="tables-content"><%= t('compare.show.tables') %></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="charts-tab" data-toggle="tab" href="#charts"
        role="tab" aria-controls="charts-content"><%= t('compare.show.charts') %></a>
    </li>
</ul>

<div class="tab-content" id="compare-results-content">
  <div class="tab-pane fade show active" id="tables" role="tabpanel" aria-labelledby="tables-tab">
    <div class="row">
      <div class="col-sm-12">
        <table id="comparison-table" class="table advice-table table-sorted">
          <thead>
            <tr>
              <th><%= t('analytics.benchmarking.configuration.column_headings.school') %></th>
              <th class="text-right">
                <%= t('analytics.benchmarking.configuration.column_headings.baseload_per_pupil_w') %>
              </th>
              <th class="text-right">
                <%= t('analytics.benchmarking.configuration.column_headings.last_year_cost_of_baseload') %>
              </th>
              <th class="text-right">
                <%= t('analytics.benchmarking.configuration.column_headings.average_baseload_kw') %>
              </th>
              <th class="text-right">
                <%= t('analytics.benchmarking.configuration.column_headings.baseload_percent') %>
              </th>
              <th class="text-right">
                <%= t('analytics.benchmarking.configuration.column_headings.saving_if_matched_exemplar_school') %>
              </th>
            </tr>
          </thead>
          <tbody>
            <% @result.schools.each do |school| %>
              <tr>
                <td>
                  <%= link_to school.name, advice_page_path(school, @result.definition.advice_page, :insights) %>
                  <% if @result.metric(school, :electricity_economic_tariff_changed_this_year)&.value == true %>
                    <a href="#electricity_economic_tariff_changed_this_year">[t]</a>
                  <% end %>
                </td>
                <td class="text-right">
                  <% @result.with_metric(school, :one_year_baseload_per_pupil_kw) do |metric| %>
                    <%= @result.format(metric.value * 1000.0, metric.units.to_sym) %>
                  <% end %>
                </td>
                <td class="text-right">
                  <%= @result.format_metric(school, :average_baseload_last_year_gbp) %>
                </td>
                <td class="text-right">
                  <%= @result.format_metric(school, :average_baseload_last_year_kw) %>
                </td>
                <td class="text-right">
                  <%= @result.format_metric(school, :annual_baseload_percent) %>
                </td>
                <td class="text-right">
                  <% @result.with_metric(school, :one_year_saving_versus_exemplar_gbp) do |metric| %>
                    <%= @result.format([0.0, metric.value].max, metric.units.to_sym) if metric.present? %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="6">
                <p>
                  <strong><%= t('analytics.benchmarking.content.footnotes.notes') %></strong>
                </p>
                <a name="electricity_economic_tariff_changed_this_year">[t]</a>
                <%= t('analytics.benchmarking.configuration.the_tariff_has_changed_during_the_last_year_html') %>
                <%= t('analytics.benchmarking.configuration.column_heading_explanation.last_year_definition_html') %>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
  <div class="tab-pane fade show" id="charts" role="tabpanel" aria-labelledby="charts-tab">
    <%= benchmark_chart_tag(@chart[:config_name], @chart) %>
  </div>
</div>
