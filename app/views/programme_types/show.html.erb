<% cache_if current_user.nil?, [@programme_type, I18n.locale], expires_in: 1.hour do %>
  <% content_for :page_title do %>
    <%= @programme_type.title %>
  <% end %>

  <div class="row padded-row">
    <div class="col-md-3">
      <%= render 'programme_types/image', programme_type: @programme_type, css_class: '' %>
    </div>
    <div class="col-md-6">
      <h2><%= @programme_type.title %></h2>
      <p><%= @programme_type.short_description %></p>
      <% if Flipper.enabled?(:todos) %>
        <p><%= render 'intention', programme_type: @programme_type %></p>
      <% end %>
      <p><%= t('programme_types.cards.bonus_points_html',
               bonus_score: tag.span(@programme_type.bonus_score, class: 'badge badge-success')) %></p>
    </div>
    <div class="col-md-3">
      <%= link_to t('programme_types.show.view_all_programmes'), programme_types_path,
                  class: 'btn btn-secondary float-right' %>
    </div>
  </div>

  <div class="row padded-row">
    <div class="col-md-9">
      <h3><%= t('programme_types.show.overview') %></h3>
      <p><%= @programme_type.description %></p>
    </div>
    <div class="col-md-3 text-right programme-type-download-links" data-event-value="<%= @programme_type.id %>">
      <% if @programme_type.document_link.present? %>
        <%= link_to @programme_type.document_link, class: 'btn btn-lg', target: '_blank', rel: 'noopener' do %>
          <%= t('programme_types.show.download') %> <%= fa_icon('download') %>
        <% end %>
      <% end %>
    </div>
  </div>

  <% if current_user.nil? %>
    <%= render 'prompt_login', programme_type: @programme_type %>
  <% end %>

  <% programme = @programme_type.programme_for_school(current_user_school) if current_user_school %>

  <% if current_user_school && !programme && can?(:start_programme, current_user_school) %>
    <%= render 'programme_types/prompts/prompt', programme_type: @programme_type, school: current_user_school %>
  <% elsif programme&.completed? %>
    <%= render 'programme_types/prompts/completed', programme: programme %>
  <% elsif programme&.started? %>
    <%= render 'programme_types/prompts/started', programme: programme %>
  <% end %>

  <%= render 'shared/todos/list',
             assignable: @programme_type,
             completable: programme,
             task_type: 'ActivityType',
             label: t('common.labels.pupil_led_activities') %>

  <%= render 'shared/todos/list',
             assignable: @programme_type,
             completable: programme,
             task_type: 'InterventionType',
             label: t('common.labels.energy_saving_actions') %>

<% end %>
