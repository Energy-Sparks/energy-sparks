<% content_for :page_title do %>
  <%= @programme_type.title %>
<% end %>

<div class="row padded-row">
  <div class="col-md-3">
    <%= render 'programme_types/image', programme_type: @programme_type, css_class: "" %>
  </div>
  <div class="col-md-6">
    <h2><%= @programme_type.title %></h2>
    <p><%= @programme_type.short_description %></p>
  </div>
  <div class="col-md-3">
    <%= link_to "View all programmes", programme_types_path, class: 'btn btn-secondary float-right' %>
  </div>
</div>

<div class="row padded-row">
  <div class="col-md-9">
    <h3>Overview</h3>
    <p><%= @programme_type.description %></p>
  </div>
  <div class="col-md-3 text-center programme-type-download-links" data-event-value="<%= @programme_type.id %>">
    <% if @programme_type.document_link.present? %>
      <%= link_to @programme_type.document_link, class: "btn btn-lg", target: '_blank' do %>
        Download <%= fa_icon("download") %>
      <% end %>
    <% end %>
  </div>
</div>

<% if current_user_school && !@user_progress.enrolled?(@programme_type) && can?(:start_programme, current_user_school) %>
  <%= render 'prompt', programme_type: @programme_type, school: current_user_school %>
<% end %>

<% if @user_progress.completed?(@programme_type) %>
  <%= render 'completed', programme_type: @programme_type, school: current_user_school %>
<% elsif @user_progress.enrolled?(@programme_type) %>
  <%= render 'started', programme_type: @programme_type, school: current_user_school %>
<% end %>

<% if @user_progress.in_progress?(@programme_type) %>
  <h3>Current Progress</h3>
<% else %>
  <h3>Activities</h3>
<% end %>

<% @programme_type.activity_types_by_position.each_with_index do |activity_type, idx| %>
  <div class="row mt-4">
    <div class="col-sm-2 text-center align-self-center">
      <% if @user_progress.enrolled?(@programme_type) %>
        <% if @user_progress.completed_activity?(@programme_type, activity_type) %>
          <span class="h4 check"><%= far_icon("check-circle text-success fa-2x") %></span>
        <% else %>
          <span class="h4 check"><%= far_icon("circle text-muted fa-2x") %></span>
        <% end %>
      <% else %>
        <span class="h4"><%= idx + 1 %>.</span>
      <% end %>
    </div>
    <div class="col-sm-10">
      <h4>
        <% if @user_progress.enrolled?(@programme_type) && @user_progress.completed_activity?(@programme_type, activity_type) %>
          <%= activity_type.name %>
        <% else %>
          <%= link_to activity_type.name, activity_type_path(activity_type) %>
        <% end %>
      </h4>
      <div class="row">
        <div class="col-sm-2">Points</div>
        <div class="col-sm-1">
          <%= render 'activity_types/activity_type_score', activity_type: activity_type %>
        </div>
        <% if @user_progress.completed_activity?(@programme_type, activity_type) %>
          <div class="col-sm-3">
            Completed on
          </div>
          <div class="col-sm-6">
            <%= link_to nice_dates(@user_progress.completed_activity(@programme_type, activity_type).happened_on), school_activity_path(current_user_school, @user_progress.completed_activity(@programme_type, activity_type)) %>
          </div>
        <% end %>

      </div>

      <div class="col-sm-2">
      </div>

    </div>
  </div>
<% end %>
