<%= render 'enhanced_header' %>

<table width="100%" class="mt-3 table advice-table table-sorted ">
  <thead>
    <tr>
      <% if @fuel_types.include?(:electricity) %>
        <th colspan="2"><%= fa_icon fuel_type_icon(:electricity) %> <%= t('common.electricity') %></th>
      <% end %>
      <% if @fuel_types.include?(:gas) %>
        <th colspan="2"><%= fa_icon fuel_type_icon(:gas) %> <%= t('common.gas') %></th>
      <% end %>
      <% if @fuel_types.include?(:storage_heaters) %>
        <th colspan="2"><%= fa_icon fuel_type_icon(:storage_heaters) %> <%= t('common.storage_heaters') %></th>
      <% end %>
      <th colspan="1"><%= t('common.school') %></th>
    </tr>
    <tr>
      <% if @fuel_types.include?(:electricity) %>
        <th><%= t('common.labels.last_week') %></th>
        <th><%= t('common.labels.last_year') %></th>
      <% end %>
      <% if @fuel_types.include?(:gas) %>
        <th><%= t('common.labels.last_week') %></th>
        <th><%= t('common.labels.last_year') %></th>
      <% end %>
      <% if @fuel_types.include?(:storage_heaters) %>
        <th><%= t('common.labels.last_week') %></th>
        <th><%= t('common.labels.last_year') %></th>
      <% end %>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @school_group.schools.visible.order(:name).each do |school| %>
      <% recent_usage = school.recent_usage %>
      <tr>
        <% if @fuel_types.include?(:electricity) %>
          <td class="<%= recent_usage&.electricity&.week&.message_class %>" data-order="<%= recent_usage&.electricity&.week&.change&.gsub('%','')&.to_f || '0' %>">
            <%= up_downify(recent_usage&.electricity&.week&.change || 'n/a') %>
          </td>
          <td class="<%= recent_usage&.electricity&.year&.message_class %>" data-order="<%= recent_usage&.electricity&.year&.change&.gsub('%','')&.to_f || '0'  %>">
            <%= up_downify(recent_usage&.electricity&.year&.change || 'n/a') %>
          </td>
        <% end %>
        <% if @fuel_types.include?(:gas) %>
          <td class="<%= recent_usage&.gas&.week&.message_class %>" data-order="<%= recent_usage&.gas&.week&.change&.gsub('%','')&.to_f || '0' %>">
            <%= up_downify(recent_usage&.gas&.week&.change || 'n/a') %>
          </td>
          <td class="<%= recent_usage&.gas&.year&.message_class %>" data-order="<%= recent_usage&.gas&.year&.change&.gsub('%','')&.to_f || '0' %>">
            <%= up_downify(recent_usage&.gas&.year&.change || 'n/a') %>
          </td>
        <% end %>
        <% if @fuel_types.include?(:storage_heaters) %>
          <td class="<%= recent_usage&.storage_heaters&.week&.message_class %>" data-order="<%= recent_usage&.storage_heaters&.week&.change&.gsub('%','')&.to_f || '0' %>">
            <%= up_downify(recent_usage&.storage_heaters&.week&.change || 'n/a') %>
          </td>
          <td class="<%= recent_usage&.storage_heaters&.year&.message_class %>" data-order="<%= recent_usage&.storage_heaters&.year&.change&.gsub('%','')&.to_f || '0' %>">
            <%= up_downify(recent_usage&.storage_heaters&.year&.change || 'n/a') %>
          </td>
        <% end %>
        <td>
          <%= link_to school.name, school_path(school) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
