<% content_for :header_title, "#{@school.name} - Meters" %>

<h3>School information</h3>
<%= render Layout::GridComponent.new(classes: 'w-100', cell_classes: 'mb-2',
                                     component_classes: 'rounded-2 bg-light pt-3 px-4 h-100', cols: 2) do |grid| %>
  <%= grid.with_block do %>
    <dl class="row">
      <dt class="col-5">
        <%= t('advice_pages.how_have_we_analysed_your_data.school_characteristics_table.rows.floor_area') %>
      </dt>
      <dd class="col-7"><%= @school.floor_area %>m<sup>2</sup></dd>
      <dt class="col-5">
        <%= t('advice_pages.how_have_we_analysed_your_data.school_characteristics_table.rows.location') %>
      </dt>
      <dd class="col-7"><%= @school.full_location_to_s %></dd>
      <dt class="col-5">
        <%= t('advice_pages.how_have_we_analysed_your_data.school_characteristics_table.rows.pupils') %>
      </dt>
      <dd class="col-7"><%= @school.number_of_pupils %></dd>
      <dt class="col-5">
        <%= t('advice_pages.how_have_we_analysed_your_data.school_characteristics_table.rows.type') %>
      </dt>
      <dd class="col-7"><%= t("common.school_types.#{@school.school_type}") %></dd>
      <dt class="col-5">Number of users</dt>
      <dd class="col-7"><%= @school.active_adult_users.count %>
        <% if @school.active_adult_users.any? %>
          (<%= @school.active_alert_contacts.count %> receiving alerts)
        <% end %>
      </dd>
    </dl>
  <% end %>
  <%= grid.with_block do %>
    <dl class="row">
      <% if @school.school_onboarding.complete? %>
        <dt class="col-5">Date onboarded</dt>
        <dd class="col-7"><%= nice_dates(@school.school_onboarding.completed_on) %></dd>
      <% end %>
      <% if @school.data_enabled? %>
        <dt class="col-5">Date made data enabled</dt>
        <dd class="col-7">
          <%= nice_dates(
                @school.school_onboarding.first_made_data_enabled || @school.school_onboarding.completed_on
              ) %>
        </dd>
      <% end %>
    </dl>
  <% end %>
<% end %>

<% if @meters.any? %>
  <h4><%= t('advice_pages.how_have_we_analysed_your_data.energy_data') %></h4>
  <%= render Schools::EnergyDataStatusComponent.new(
        school: @school,
        show_fuel_icon: true,
        table_small: false
      ) %>
  <h4><%= t('school_groups.status.individual_meter_data') %></h4>
  <table class="table table-sorted">
    <thead class="thead-dark text-nowrap">
      <tr>
        <th></th>
        <th>Meter type</th>
        <th class="text-left">MPXN</th>
        <th class="text-left">Name</th>
        <th>Start date</th>
        <th>End date</th>
      </tr>
    </thead>
    <tbody>
      <% @meters.order('meter_type, active desc').each do |meter| %>
        <tr>
          <td>
            <%= render Elements::IconComponent.new(fuel_type: meter.fuel_type) %>
          </td>
          <td class="text-left"><%= t(meter.fuel_type, scope: 'common') %></td>
          <td class="text-left"><%= meter.mpan_mprn %></td>
          <td class="w-100 text-left"><%= meter.name.to_s %></td>
          <td class="text-nowrap"><%= short_dates(meter.first_validated_reading) %></td>
          <td class="text-nowrap"><%= short_dates(meter.last_validated_reading) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <%= render PromptComponent.new status: :neutral, style: :compact, icon: 'gauge' do |c| %>
    <%= t('school_groups.status.no_meters') %>
  <% end %>
<% end %>
