<% content_for :page_title, "#{t('advice_pages.index.title')} | #{@school_group.name}" %>

<% content_for :dashboard_header do %>
  <%= render Layout::Cards::PageHeaderComponent.new(
        title: t('school_groups.advice.show.title'),
        subtitle: t('school_groups.advice.show.subtitle_html')
      ) %>
<% end %>

<div class="container">
  <div class="row mt-2">
    <div id="group-advice-page-nav" class="col-md-3 col-lg-3 col-xl-2 advice-page-nav">
      <%= render 'school_groups/advice/shared/nav', school_group: @school_group %>
    </div>
    <div id='group-advice-page-content' class="col-md-9 col-lg-9 col-xl-10">
      <h2>
        <%= t('school_groups.advice.show.recent_energy_use.title') %>
      </h2>
      <%= render 'school_groups/advice/shared/message', school_group: @school_group %>

      <% cache [@school_group.most_recent_content_generation_run, I18n.locale], expires_in: 4.hours do %>
        <%= render Dashboards::GroupEnergySummaryComponent.new(
              school_group: @school_group,
              schools: @schools,
              fuel_types: @fuel_types,
              metric: params[:metric],
              classes: 'mt-2',
              show_clusters: can?(:update_settings, @school_group)
            ) do |summary| %>
            <% summary.with_modal_link do %>
              <%= render 'school_groups/advice/shared/analysis_footnotes_link' %>
            <% end %>
            <% summary.with_footer do %>
              <%= render 'school_groups/advice/shared/analysis_footnotes',
                         school_group: @school_group,
                         schools: @schools,
                         fuel_types: @fuel_types,
                         extra_notes:
                          t('school_groups.advice_pages.how_have_we_analysed_your_data.summary_table_notes_html') %>
            <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
