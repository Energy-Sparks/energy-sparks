<div class="d-flex justify-content-between align-items-center">
  <h1>
    Reducing your <%= @fuel_type.to_s.humanize(capitalize: false) %> usage by <%= @school_target.target_date.strftime("%b %Y") %>
  </h1>
  <div>
    <%= link_to "Review targets", school_school_target_path(@school, @school_target), class: "btn btn-outline-dark rounded-pill font-weight-bold" %>
    <%= link_to_help_for_feature :school_targets, css: "btn btn-outline-dark rounded-pill font-weight-bold" %>
  </div>
</div>

<p>
  Your school set a target to reduce its <%= @fuel_type.to_s.humanize(capitalize: false) %> usage by <%= @school_target.attributes[@fuel_type.to_s] %>% between <strong><%= nice_dates(@school_target.start_date) %></strong> and <strong><%= nice_dates(@school_target.target_date) %></strong>.
</p>

<p>
  This page shows your final progress for that twelve month period.
</p>

<% if @progress %>

  <h3>Month by month progress</h3>

  <table class="table table-bordered table-hover table-sm">
    <thead class="thead-dark">
    <tr>
      <th>
        Month
      </th>
      <% @reporting_months.each do |month| %>
        <th class="text-right">
          <%= month.strftime('%b') %>
        </th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <%= render 'row', title: 'Target Consumption (kWh)', progress: @progress, data: @progress.monthly_targets_kwh, keys: @reporting_months, partial_months: {}, percentage_synthetic: @progress.percentage_synthetic, units: :kwh, final_row: false %>
    <%= render 'row', title: 'Actual Consumption (kWh)', progress: @progress, data: @progress.monthly_usage_kwh, keys: @reporting_months, partial_months: @progress.partial_months, percentage_synthetic: {}, units: :kwh, final_row: false %>
    <%= render 'row', title: 'Overall change since last year', progress: @progress, data: @progress.monthly_performance_versus_synthetic_last_year, keys: @reporting_months, partial_months: @progress.partial_months, percentage_synthetic: {}, units: :relative_percent, final_row: true %>
    </tbody>
  </table>

  <h3>Cumulative progress</h3>

  <table class="table table-bordered table-hover table-sm">
    <thead class="thead-dark">
    <tr>
      <th>
        Month
      </th>
      <% @reporting_months.each do |month| %>
        <th class="text-right">
          <%= month.strftime('%b') %>
        </th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <%= render 'row', title: 'Target Consumption (kWh)', data: @progress.cumulative_targets_kwh, keys: @reporting_months, partial_months: {}, percentage_synthetic: @progress.percentage_synthetic, units: :kwh, final_row: false %>
    <%= render 'row', title: 'Actual Consumption (kWh)', data: @progress.cumulative_usage_kwh, keys: @reporting_months, partial_months: @progress.partial_months, percentage_synthetic: {}, units: :kwh, final_row: false %>
    <%= render 'row', title: 'Overall performance since last year', data: @progress.cumulative_performance_versus_synthetic_last_year, keys: @reporting_months, partial_months: @progress.partial_months, percentage_synthetic: {}, units: :relative_percent, final_row: true %>
    </tbody>
  </table>

  <h5 class="font-weight-bold">Footnotes</h5>

  <div class="ml-2">
    <% if @show_storage_heater_notes %>
      <p>
        This report only shows progress on reducing your electricity usage. Your <%= link_to 'storage heater progress report', storage_heater_school_progress_index_path(@school) %> can be viewed separately.
      </p>
    <% end %>

    <p>
    We use colour coding to indicate when you have <span class="bg-positive-dark">met your target</span> or <span class="bg-negative-dark">failed to meet your target</span> in a given month
    </p>

    <% if @progress.partial_consumption_data? %>
      <p>Consumption data <span class="partial-month">shown in red</span> indicates a month for which we had only partial data.</p>
    <% end %>

    <% if @progress.reporting_period_before_consumption_data? %>
      <% if @school.configuration.meter_start_date(@fuel_type).present? %>
        <p>We only have data on your <%= @fuel_type.to_s.humanize(capitalize: false) %> consumption from <%= @school.configuration.meter_start_date(@fuel_type).strftime("%b %Y") %>. The report will only show your consumption for a portion of your target period.</p>
      <% else %>
        <p>We only have limited data on your actual <%= @fuel_type.to_s.humanize(capitalize: false) %> consumption. The report will only show your consumption for a portion of your target period.</p>
      <% end %>
    <% end %>

    <% if @progress.targets_derived_from_synthetic_data? %>
      <p>
        Monthly targets <i>shown in italics</i> have been created from the <%= link_to 'annual estimate', school_estimated_annual_consumptions_path(@school) %> you provided, rather than your historical data. Their accuracy will depend on the quality of your estimate.
      </p>
    <% end %>

    <% if @progress.partial_target_data? %>
      <p>
        We only have limited historical consumption data for your school, so we cannot currently calculate a full set of monthly targets or progress.
        You can <%= link_to 'provide us with an annual estimate', school_estimated_annual_consumptions_path(@school) %> to see more detail.
      </p>
    <% end %>
  </div>
<% end %>
