<p><%= t('schools.meters.form.title') %></p>
<%= form_for [school, meter] do |form| %>
  <%= render 'shared/errors', subject: meter, subject_name: 'meter' %>

  <div class="form-group">
    <%= form.label :mpan_mprn, t('schools.meters.form.meter_point_number') %>
    <% if disabled_for_pseudo_meter?(meter) && current_user.admin? %>
      <span class='badge badge-warning'>
        <%= t('schools.meters.form.editing_disabled_for_pseudo_meters') %>
      </span>
    <% end %>
    <%= form.text_field :mpan_mprn, class: 'form-control', disabled: disabled_for_pseudo_meter?(meter) %>
  </div>
  <div class="form-group">
    <%= form.label :name,  t('schools.meters.form.name') %>
    <%= form.text_field :name, class: 'form-control' %>
  </div>
  <div class="form-group">
    <%= form.label :meter_serial_number, t('schools.meters.form.serial_number') %>
    <%= form.text_field :meter_serial_number, class: 'form-control' %>
  </div>
  <div class="form-group">
    <%= form.label :meter_type, t('schools.meters.form.type') %>
    <% if disabled_for_pseudo_meter?(meter) && current_user.admin? %>
      <span class='badge badge-warning'>
        <%= t('schools.meters.form.editing_disabled_for_pseudo_meters') %>
      </span>
    <% end %>
    <% Meter::CREATABLE_METER_TYPES.each do |meter_type| %>
      <div class="form-check">
        <%= form.radio_button :meter_type, meter_type, class: "form-check-input", disabled: disabled_for_pseudo_meter?(meter) %>
        <%= form.label "meter_type_#{meter_type.to_sym}", t("schools.meters.creatable_meter_types.#{meter_type}"),  class: "form-check-label col-form-label-sm" %>
      </div>
    <% end %>
  </div>
  <% if current_user.admin? %>
    <div class="form-group">
      <%= form.label :notes, t('schools.meters.form.admin_notes') %>
      <div class="trix-wrapper">
        <%= form.rich_text_area :notes %>
      </div>
    </div>
  <% end %>

  <div class="form-group">
    <% if show_dcc_fields %>
      <p class="alert alert-warning"><%= t('schools.meters.form.admin_only_features_for_n3rgy_integration') %></p>

      <div class="custom-control custom-checkbox">
        <%= form.check_box :dcc_meter, class: 'custom-control-input'  %>
        <%= form.label :dcc_meter, t('schools.meters.form.dcc_smart_meter'), class: "custom-control-label"  %>
        <small class="form-text text-muted">
          <%= t('schools.meters.form.leave_this_blank_message') %>
        </small>
      </div>

      <div class="custom-control custom-checkbox">
        <%= form.check_box :sandbox, class: 'custom-control-input' %>
        <%= form.label :sandbox, t('schools.meters.form.sandbox'), class: "custom-control-label" %>
        <small class="form-text text-muted"><%= t('schools.meters.form.only_check_if_adding_an_n3rgy_test_meter') %></small>
      </div>

      <div class="form-group">
        <%= form.label :earliest_available_data, t('schools.meters.form.earliest_available_data') %>
        <%= date_field(:meter, :earliest_available_data, max: Time.zone.today, min: Date.parse("2012-01-01", locale: I18n.locale)) %>
      </div>
    <% end %>
  </div>

  <div class="actions">
    <% submit_label = action_name == 'edit' ? t('schools.meters.form.update_meter') : t('schools.meters.form.create_meter') %>
    <%= form.submit submit_label, class: 'btn btn-primary'%>
  </div>
<% end %>
