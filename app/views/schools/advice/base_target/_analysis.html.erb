<%= render 'meeting_target_prompt' %>
<ul>
  <li><%= link_to(t('advice_pages.target.analysis.monthly_progress.title'), '#monthly-progress') %></li>
  <li><%= link_to(t('advice_pages.target.analysis.cumulative_progress.title'), '#cumulative-progress') %></li>
  <li><%= link_to(t('advice_pages.target.analysis.historical_progress.title'), '#historical-progress') %></li>
</ul>

<%= render 'schools/advice/section_title',
           section_id: 'monthly-progress',
           section_title: t('advice_pages.target.analysis.monthly_progress.title') %>
<table class="mt-2 table table-sm advice-table">
  <thead>
    <th><%= t('schools.school_targets.progress.current.month') %></th>
    <th><%= t('advice_pages.target.analysis.monthly_progress.last_year') %></th>
    <th><%= t('advice_pages.target.analysis.monthly_progress.target') %></th>
    <th><%= t('advice_pages.target.analysis.monthly_progress.this_year') %></th>
    <th><%= t('advice_pages.target.analysis.monthly_progress.percentage_change') %></th>
    <th><%= t('advice_pages.target.analysis.monthly_progress.on_target') %></th>
  </thead>
  <tbody>
    <% @target.monthly_consumption(@fuel_type).each do |month| %>
      <tr>
        <td><%= Date.new(month[:year], month[:month]).strftime('%B %Y') %>
        <td><%= format_unit(month[:previous_consumption], :kw) %></td>
        <td><%= format_unit(month[:target_consumption], :kw) %></td>
        <%= tag.td(class: month[:missing] ? 'old-data' : nil) do %>
          <% unless month[:current_consumption].zero? && month[:missing] %>
            <%= format_unit(month[:current_consumption], :kw) %>
          <% end %>
        <% end %>
        <td>
          <% unless month[:missing] %>
            <%= up_downify(format_unit(percent_change(month[:current_consumption], month[:target_consumption]),
                                       :relative_percent),
                           sanitize: false) %>
          <% end %>
        </td>
        <td>
          <% unless month[:missing] %>
            <%= checkmark(month[:current_consumption] < month[:target_consumption]) %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= tag.div(t('advice_pages.target.analysis.monthly_progress.partial'), class: 'text-right advice-table-caption') %>

<%= render 'schools/advice/section_title',
           section_id: 'cumulative-progress',
           section_title: t('advice_pages.target.analysis.cumulative_progress.title') %>

<%= render 'schools/advice/section_title',
           section_id: 'historical-progress',
           section_title: t('advice_pages.target.analysis.historical_progress.title') %>
<%= t('advice_pages.target.analysis.historical_progress.intro', fuel_type: @fuel_type) %>
