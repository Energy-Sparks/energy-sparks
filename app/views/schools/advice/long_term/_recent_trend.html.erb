<%= render 'schools/advice/section_title', section_id: 'recent-trend',
           section_title: t('advice_pages.electricity_long_term.analysis.recent_trend.title') %>

<% if analysis_dates.one_years_data? %>
  <% if annual_usage.kwh < vs_exemplar.kwh %>
    <%= component 'notice', status: :positive do %>
      <p><%= t("advice_pages.#{fuel_type}_long_term.analysis.comparison.assessment.low.title") %></p>
      <p><%= t("advice_pages.#{fuel_type}_long_term.analysis.comparison.assessment.low.percent_html",
               percent: format_unit(estimated_savings_vs_exemplar.percent.abs, :percent)) %></p>
    <% end %>
  <% else %>
    <%= component 'notice', status: :negative do %>
      <p><%= t("advice_pages.#{fuel_type}_long_term.analysis.comparison.assessment.high.title") %></p>
      <p><%= t("advice_pages.#{fuel_type}_long_term.analysis.comparison.assessment.high.percent_html",
               percent: format_unit(estimated_savings_vs_exemplar.percent, :percent)) %></p>
      <p><%= t("advice_pages.#{fuel_type}_long_term.analysis.comparison.assessment.high.savings_html",
               estimated_savings_kwh: format_unit(estimated_savings_vs_exemplar.kwh, :kwh, false),
               estimated_savings_gbp: format_unit(estimated_savings_vs_exemplar.£, :£, false) ) %></p>
    <% end %>
  <% end %>

  <%= component 'chart', chart_type: :"group_by_week_#{fuel_type}", school: school do |c| %>
    <% c.with_title { t("advice_pages.#{fuel_type}_long_term.charts.group_by_week_#{fuel_type}.title") } %>
    <% c.with_subtitle { t("advice_pages.#{fuel_type}_long_term.charts.group_by_week_#{fuel_type}.subtitle_html",
                           start_date: analysis_dates.last_full_week_start_date.to_s(:es_short),
                           end_date: analysis_dates.last_full_week_end_date.to_s(:es_short)) } %>
    <% c.with_footer do %>
      <p><%= t("advice_pages.#{fuel_type}_long_term.charts.group_by_week_#{fuel_type}.explanation_html") %></p>
    <% end %>
  <% end %>
<% else %>
  <% chart_type = :"management_dashboard_group_by_week_#{fuel_type}" %>
  <%= component 'chart', chart_type: chart_type, school: school,
                         chart_config: { y_axis_units: select_y_axis(school, chart_type, :£) } %>
<% end %>

<%= component 'chart', chart_type: :"#{fuel_type}_by_month_year_0_1", school: school do |c| %>
  <% c.with_title { t("advice_pages.#{fuel_type}_long_term.charts.#{fuel_type}_by_month_year.title") } %>
  <% c.with_subtitle { t("advice_pages.#{fuel_type}_long_term.charts.#{fuel_type}_by_month_year.subtitle_html",
                         end_date: analysis_dates.end_date.to_s(:es_short)) } %>
  <% c.with_footer do %>
    <p><%= t("advice_pages.#{fuel_type}_long_term.charts.#{fuel_type}_by_month_year.explanation") %></p>
  <% end %>
<% end %>
