<%= tag.div id: id, class: classes do %>
  <% if modal_link? %>
    <div class="mt-3 text-right">
      <%= modal_link %>
    </div>
  <% end %>
  <table id="<%= "school-group-recent-usage-#{fuel_type}" %>"
         width="100%"
         class="table table-sm advice-table table-sorted">
    <thead>
      <tr>
        <th colspan="1"><%= t('common.school') %></th>
        <% if show_clusters? %>
          <th><%= t('school_groups.clusters.labels.cluster') %></th>
        <% end %>
        <% periods.each do |period| %>
          <th class="text-right">
            <%= period_label(period) %>
          </th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% schools.data_enabled.order(:name).each do |school| %>
        <% if school.configuration.fuel_configuration.fuel_types.include?(fuel_type) %>
          <tr>
            <td>
              <%= link_to school.name, school_path(school) %>
            </td>
            <% if show_clusters? %>
              <td>
                <%= school.school_group_cluster_name %>
              </td>
            <% end %>
            <% recent_usage = school.recent_usage %>
            <% periods.each do |period| %>
              <% period_data = recent_usage.dig(fuel_type, period) %>
              <% if period_data&.has_data %>
                <td class="<%= class_names('text-right', period_data&.message_class) %>"
                    data-order="<%= value_for(period_data, formatted: false) %>">
                  <%= up_downify(value_for(period_data, formatted: true)) %>
                </td>
              <% else %>
                <td class="text-right" data-order="0">-</td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>

  <% if modal_link? && schools.length > 20 %>
    <div class="text-right">
      <%= modal_link %>
    </div>
  <% end %>
<% end %>
